<html>

<head>
    <meta charset="UTF-8">
    <title>Flashcard</title>
</head>


<body>

    <h1 th:text="${deck.name}"></h1>
    <div th:if="${not #lists.isEmpty(flashcards)}">

        <h1>Flashcards</h1>
        <table>
            <tr>
                <th>ID</th>
                <th>Question</th>
                <th>Answer</th>
                <th>Deck</th>
            </tr>
            <tr th:each="flashcard : ${flashcards}">
                <td th:text="${flashcard.id}"></td>
                <td th:text="${flashcard.question}"></td>
                <td th:text="${flashcard.reponse}"></td>
                <td th:text="${flashcard.deck.name}"></td>


                <td>
                    <button class="btn btn-danger" th:onclick="'javascript:deleteFlashCard(' + ${deck.id} + ',' + ${flashcard.id} + ')'">
                        <span class="fa fa-trash"></span> Delete
                    </button>
                </td>
                <td>
                    <a th:href="@{/main/flashcard/edit/{id}(id=${flashcard.id})}">Edit</a>
                </td>
            </tr>
        </table>
    </div>


    <div th:if="${#lists.isEmpty(flashcards)}">
        <p>No flashcards available.</p>
    </div>

    <form method="post" role="form" th:action="@{/main/flashcard/save}">
        <div class="form-group mb-3">
            <label class="control-label"> Question</label>
            <input type="text" id="question" name="question" class="form-control" placeholder="Enter question" />
        </div>

        <div class="form-group mb-3">
            <label class="control-label"> Reponse</label>
            <input type="text" id="answer" name="reponse" class="form-control" placeholder="Enter answer" />
        </div>

        <input type="hidden" id="deckId" name="deckId" th:value="${deck.id}" />

        <input type="submit" value="Enregistrer">
    </form>

    <a href="/main/deck" class="btn btn-primary">Back to decks</a>

</body>

</html>

<script>
    function deleteFlashCard(deckId,flashcardId) {
        console.log("Deleting flashcard " + flashcardId)

        if (confirm("Are you sure you want to delete this flashcard ?")) {
            // Send a DELETE request using AJAX
            fetch(`/main/flashcard/delete/${deckId}/${flashcardId}`, {
                method: 'GET'
            })
                .then(response => {
                    if (response.ok) {
                        // Handle successful deletion
                        // You can reload the page or update the deck list as needed
                        location.reload();
                    } else {
                        // Handle deletion failure
                        alert('Failed to delete the flashcard.');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    }
</script>